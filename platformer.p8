pico-8 cartridge // http://www.pico-8.com
version 15
__lua__

--
-- game loop.
--

function _init()
 g = game()
end

function _update60()
 local l = btn(0)
 local r = btn(1)
 g = game.update(g, l, r)
end

function _draw()
 cls()
 map(0, 0, 0, 0, 128, 128)
 player.draw(g.player)
end
-->8

--
-- entities.
--

--
-- player.
--

player = {}

setmetatable(player, {
 __call = function(_, x, y)
  return {
   -- constants.
   sp = 1,
   grav = 0.15,
   max_dx = 1,
   max_dy = 2,

   -- state.
   x = x or 0,
   y = y or 0,
   dx = 0,
   dy = 0,
  }
 end,
})

-- player -> bool -> bool -> player
-- this function is pure.
function player.update(p, l, r)
 -- move x.
 if (l) p.x -= 1
 if (r) p.x += 1
 
 -- move y.
 p.dy += p.grav
 p.dy = mid(-p.max_dy, p.dy, p.max_dy)
 p.y += p.dy

 return p
end

-- player -> void
function player.draw(p)
 spr(p.sp, p.x, p.y)
end

--
-- game.
--

game = {}

setmetatable(game, {
 __call = function()
  return {
   player = player(),
  }
 end,
})

-- game -> bool -> bool -> game
-- this function is pure.
function game.update(g, l, r)
 g.player = player.update(g.player, l, r)
 return g
end

-- todo: falling collisions
-- todo: try weighted averaging
__gfx__
00000000000000001111111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000000001999999100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000000001911119100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000000001911119100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00077000000880001911119100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00700700000880001911119100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000880001999999100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
00000000000880001111111100000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__gff__
0000010000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
__map__
0000000000000000000002020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0000000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000000000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200020202000202000202020202000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000000002000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0200000000000000000000020002000200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
0202020202020202020202020202020200000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000
